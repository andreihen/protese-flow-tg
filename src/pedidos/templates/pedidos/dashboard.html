{% extends 'base.html' %}

{% block content %}
<div class="container-fluid px-4 mt-4">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-primary fw-bold mb-0">Fila de Produção</h2>
            <p class="text-muted small mb-0">Selecione um cartão abaixo para filtrar a lista.</p>
        </div>
        
        <div class="d-flex gap-2">
            {% if status_selecionado %}
                <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary fw-bold shadow-sm">
                    <i class="bi bi-x-lg me-1"></i> Ver Todos
                </a>
            {% endif %}

            <a href="{% url 'novo_pedido' %}" class="btn btn-primary fw-bold shadow-sm">
                <i class="bi bi-plus-lg me-1"></i> Novo Pedido
            </a>
        </div>
    </div>

    <div class="row g-3 mb-4">
        
        <div class="col-md-3">
            <a href="?status=PENDENTE" class="text-decoration-none">
                <div class="card border-0 shadow-sm card-hover {% if status_selecionado == 'PENDENTE' %}ring-active border-warning{% endif %}">
                    <div class="card-body p-3 d-flex align-items-center justify-content-between border-start border-4 border-warning bg-white rounded">
                        <div>
                            <h6 class="text-muted text-uppercase fw-bold small mb-1">Pendente</h6>
                            <h2 class="mb-0 fw-bold text-dark">{{ kpi_pendentes }}</h2>
                        </div>
                        <div class="icon-shape bg-warning bg-opacity-10 text-warning p-3 rounded-circle">
                            <i class="bi bi-hourglass-split fs-4"></i>
                        </div>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a href="?status=EM_PRODUCAO" class="text-decoration-none">
                <div class="card border-0 shadow-sm card-hover {% if status_selecionado == 'EM_PRODUCAO' %}ring-active border-info{% endif %}">
                    <div class="card-body p-3 d-flex align-items-center justify-content-between border-start border-4 border-info bg-white rounded">
                        <div>
                            <h6 class="text-muted text-uppercase fw-bold small mb-1">Iniciado</h6>
                            <h2 class="mb-0 fw-bold text-dark">{{ kpi_iniciados }}</h2>
                        </div>
                        <div class="icon-shape bg-info bg-opacity-10 text-info p-3 rounded-circle">
                            <i class="bi bi-gear-wide-connected fs-4"></i>
                        </div>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a href="?status=CONCLUIDO" class="text-decoration-none">
                <div class="card border-0 shadow-sm card-hover {% if status_selecionado == 'CONCLUIDO' %}ring-active border-success{% endif %}">
                    <div class="card-body p-3 d-flex align-items-center justify-content-between border-start border-4 border-success bg-white rounded">
                        <div>
                            <h6 class="text-muted text-uppercase fw-bold small mb-1">Finalizado</h6>
                            <h2 class="mb-0 fw-bold text-dark">{{ kpi_finalizados }}</h2>
                        </div>
                        <div class="icon-shape bg-success bg-opacity-10 text-success p-3 rounded-circle">
                            <i class="bi bi-check-lg fs-4"></i>
                        </div>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a href="?status=APROVADO" class="text-decoration-none">
                <div class="card border-0 shadow-sm card-hover {% if status_selecionado == 'APROVADO' %}ring-active border-primary{% endif %}">
                    <div class="card-body p-3 d-flex align-items-center justify-content-between border-start border-4 border-primary bg-white rounded">
                        <div>
                            <h6 class="text-muted text-uppercase fw-bold small mb-1">Aprovado</h6>
                            <h2 class="mb-0 fw-bold text-dark">{{ kpi_aprovados }}</h2>
                        </div>
                        <div class="icon-shape bg-primary bg-opacity-10 text-primary p-3 rounded-circle">
                            <i class="bi bi-hand-thumbs-up-fill fs-4"></i>
                        </div>
                    </div>
                </div>
            </a>
        </div>

    </div>

    <style>
        .card-hover { transition: transform 0.2s, box-shadow 0.2s; }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; cursor: pointer; }
        .ring-active { border: 2px solid #0d6efd !important; transform: scale(1.02); }
    </style>

    <div class="card shadow-sm border-0">
        <div class="card-header bg-white py-3">
            <h6 class="mb-0 fw-bold text-primary">
                {% if status_selecionado %}
                    <i class="bi bi-funnel-fill me-2"></i>Filtrando por: {{ status_selecionado }}
                {% else %}
                    <i class="bi bi-clock-history me-2"></i>Últimas Atualizações
                {% endif %}
            </h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="ps-4">ID</th>
                            <th>Paciente</th>
                            <th>Serviço</th>
                            <th>Doutor</th>
                            <th>Status</th>
                            <th>Entrega</th>

                        </tr>
                    </thead>
                    <tbody>
                        {% for pedido in pedidos %}
                            <tr class="align-middle" style="cursor: pointer;" onclick="window.location.href='{% url 'editar_pedido' pedido.id %}'">
                                
                                <td class="ps-4 fw-bold">#{{ pedido.id }}</td>
                                <td class="fw-bold">{{ pedido.nome_paciente }}</td>
                                <td>
                                    {{ pedido.tipo_servico }}
                                </td>
                                <td>
                                    {% if eh_gestor %}
                                        <span class="badge bg-secondary bg-opacity-10 text-dark">
                                            {{ pedido.dentista.username }}
                                        </span>
                                    {% else %}
                                        Você
                                    {% endif %}
                                </td>
                                <td>
                                    {% if pedido.status == 'PENDENTE' %}
                                        <span class="badge bg-warning text-dark">Pendente</span>
                                    {% elif pedido.status == 'EM_PRODUCAO' %}
                                        <span class="badge bg-info text-dark">Iniciado</span>
                                    {% elif pedido.status == 'CONCLUIDO' %}
                                        <span class="badge bg-success">Finalizado</span>
                                    {% elif pedido.status == 'APROVADO' %}
                                        <span class="badge bg-primary">Aprovado</span>
                                    {% endif %}
                                </td>
                                <td>{{ pedido.data_entrega_prevista|date:"d/m/Y" }}</td>
                                
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="7" class="text-center py-5 text-muted">
                                    Nenhum pedido encontrado nesta categoria.
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}